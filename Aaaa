
import requests
import json
import urllib3

# Disable SSL warnings
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

class DigiKeySimpleChecker:
    def __init__(self):
        # --- CONFIGURATION ---
        # PASTE YOUR CREDENTIALS HERE
        self.client_id = "y9dDhzo67gdr0XAAnu2D5oJFOmtGCshaPUzAcH9WYqJXeK40"
        self.client_secret = "IMpq2URpHg6ZWNsVSYdEZy5IobJoIS3GEgwUGg4eYQDDmAcER12HCfxdtEOdcGGU"
        
        self.token = None
        self.base_url = "https://api.digikey.com"

    def get_token(self):
        """
        Gets a token using 'Client Credentials' flow.
        NO BROWSER REQUIRED.
        """
        url = "https://api.digikey.com/v1/oauth2/token"
        
        payload = {
            'grant_type': 'client_credentials', # <--- This is the magic switch
            'client_id': self.client_id,
            'client_secret': self.client_secret
        }
        
        print("Authenticating...")
        try:
            # verify=False prevents SSL errors
            response = requests.post(url, data=payload, verify=False)
            
            if response.status_code == 200:
                data = response.json()
                self.token = data['access_token']
                print("✅ Authentication Successful! (No browser needed)")
                return True
            else:
                print(f"❌ Auth Failed: {response.status_code}")
                print(response.text)
                return False
        except Exception as e:
            print(f"Connection Error: {e}")
            return False

    def search_part(self, part_number):
        if not self.token:
            return
            
        endpoint = "/products/v4/search/keyword"
        url = self.base_url + endpoint
        
        headers = {
            "Authorization": f"Bearer {self.token}",
            "X-DIGIKEY-Client-Id": self.client_id,
            "Content-Type": "application/json",
            "X-DIGIKEY-Locale-Site": "US",
            "X-DIGIKEY-Locale-Currency": "USD"
        }
        
        body = {
            "Keywords": part_number,
            "RecordCount": 1
        }
        
        print(f"Searching for {part_number}...")
        response = requests.post(url, headers=headers, json=body, verify=False)
        
        if response.status_code == 200:
            return response.json()
        else:
            print(f"Search Error: {response.status_code}")
            print(response.text)
            return None

# --- RUN THE SCRIPT ---
if __name__ == "__main__":
    app = DigiKeySimpleChecker()
    
    # Check if user forgot to paste credentials
    if "PASTE_YOUR" in app.client_id:
        # If credentials are not in the code, ask for them
        app.client_id = input("Enter Client ID: ").strip()
        app.client_secret = input("Enter Client Secret: ").strip()

    if app.get_token():
        # Search for a test part
        part = "CL21B106KOQNFNE"
        data = app.search_part(part)
        
        if data:
            try:
                product = data['Products'][0]
                price = product['ProductVariations'][0]['StandardPricing'][0]['UnitPrice']
                print(f"\n--- RESULT ---")
                print(f"Part: {product['ProductDescription']}")
                print(f"Price: ${price}")
            except:
                print("\nRaw Data Found:")
                print(json.dumps(data, indent=2))
